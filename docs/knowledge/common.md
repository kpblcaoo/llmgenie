# Knowledge Base: Common Best Practices & Workflow

---

## 1. Ведение базы знаний (knowledge base)
- Для каждой среды/модели/интеграции — отдельный файл (cursor.md, ollama.md, openai_api.md, vscode_continue.md, vscode_copilot.md).
- В каждом файле: дата/время поиска или обновления, краткое описание, ссылки на источники, примеры, внедрённые решения, TODO по обновлению.
- Вести временные метки и last_reviewed для ревизии актуальности.
- Все найденные best practices, workflow, решения — фиксировать в knowledge base или decision memos.

## 2. User rules: советы и best practices
- User rules должны быть лаконичными, конкретными, без лишних деталей.
- В user rules — только ссылки и напоминания (например, "Consult knowledge base in knowledge/ and data/knowledge/ before searching externally. Update base if new info is found.").
- Не дублировать сложные правила — выносить их в project rules (.mdc) или knowledge base.
- Регулярно ревизировать user rules, чтобы не было устаревших или дублирующих инструкций.

## 3. Project rules: структура и автоматизация
- Все enforceable/manual правила — только в .mdc-файлах с корректным frontmatter (description, globs, alwaysApply).
- Использовать вложенные каталоги для масштабируемости: core/, workflows/, roles/, languages/, security/, templates/.
- Для agent requested — чёткие, лаконичные descriptions.
- Для auto attached — globs, для always — alwaysApply: true.
- Документировать структуру в ONBOARDING и project_state.json.
- Регулярно ревизировать и избегать дублирования между каталогами.

## 4. Agent requested: гибридные сценарии
- Использовать для ситуативных, ролевых, узких сценариев (code review, docs, security audit и др.).
- Пример frontmatter:
  ```
  ---
  description: When reviewing code, enforce our code review checklist
  alwaysApply: false
  ---
  # Code Review Checklist
  ...
  ```
- Важно: description должен быть чётким и лаконичным, чтобы AI корректно подгружал правило.

## 5. Workflow по ревизии и обновлению
- При поиске новой информации — сразу фиксировать в knowledge base.
- При планировании — смотреть, что уже найдено, что требует обновления.
- AI/CLI может предлагать обновить устаревшие записи или напоминать о ревизии.
- Для каждой записи — временная метка, источник, TODO по обновлению.

## 6. Naming conventions и структура
- Использовать префиксы и нумерацию для порядка и приоритета (core, workflows, roles, languages, security, templates).
- В каждом каталоге — только .mdc-файлы с корректным frontmatter.
- Документировать структуру и naming в ONBOARDING и project_state.json.

## 7. Интеграция с AI/ассистентом
- AI должен использовать knowledge base для поиска best practices и решений до обращения к внешним источникам.
- Все новые best practices и workflow — фиксировать в knowledge base или decision memos.
- При обновлении workflow — добавлять запись в knowledge/common.md и data/knowledge/common.json.

# Общие best practices, логирование и ограничения для LLM и сред

## Логирование и session control
- Для всех сред: логировать ключевые действия, ошибки, mode switches.
- Использовать отдельные event_log, tech_log, meta-log для каждой сессии.
- Для production — автоматизировать сбор логов и ретроспективу.

## Best practices
- Проверять актуальность данных и версий моделей/плагинов.
- Использовать только trusted источники и расширения.
- Для production — реализовать fallback и обработку ошибок.

## Типовые ошибки
- Работа с устаревшими файлами/моделями.
- Проблемы с совместимостью версий.
- Недостаточное логирование.

## Ссылки
- [docs/ONBOARDING_LLMSTRUCT.md]
- [docs/knowledge/*]

## Cursor IDE: дополнительные правила
- Все предложения и планы пользователя должны критически оцениваться, при необходимости — давать совет или предупреждение.

## Workflow обновления integration knowledge base
- При внедрении новой интеграции или функции — обязательно обновлять integration.json и integration_matrix.
- В каждом integration.json вести history (дата, автор, описание изменений).
- Явно фиксировать несовместимости (incompatibilities) и ограничения.
- AI/CLI должен периодически напоминать о ревизии и актуальности базы знаний.
- При создании новой задачи на интеграцию — автоматически создавать draft в integration.json.
- Документировать workflow обновления и ответственных в этом файле.
- В будущем — реализовать визуализацию/дашборд по всем возможностям.

## Актуальные стандарты интеграции (2025-06-12)

- **MCP** — основной открытый стандарт для интеграции инструментов и внешних сервисов с LLM в VSCode и новых IDE. Поддерживается только в VSCode (agent mode) и совместимых клиентах.
- **LSP** — стандарт для языковых серверов, не для AI-интеграций. Используется в VSCode, JetBrains, Neovim и др. для языковых фич, но не для AI.
- **ToolSpec** — часть tooling в MCP/VSCode, не отдельный массовый стандарт. Используется для описания инструментов, но не поддерживается как отдельный протокол в большинстве сред.
- **OpenCtx** — экспериментальная надстройка для расширения контекста LLM, массово не поддерживается ни одной из популярных IDE/моделей напрямую. Практическая польза — только для интеграций с Sourcegraph Cody или кастомных workflow через OpenCtx/MCP.

## Новые инструменты и модели (2025-06-12)

### **CLI инструменты:**
- **ai-cli** — упрощение взаимодействия с LLM из командной строки
- **geppetto** — CLI инструмент для работы с языковыми моделями
- **Aider** — интеграция с локальными/облачными моделями в терминале
- **RAGFlow** — поддержка RAG для работы с локальными документами

### **Новые модели в Ollama:**
- **Llama 3.3** — обновленная версия от Meta
- **DeepSeek-R1** — модель от DeepSeek
- **Phi-4** — модель от Microsoft
- **Gemma 3** — модель от Google  
- **Mistral Small 3.1** — компактная модель от Mistral

### **Возможности Continue:**
- **Проект-специфичные инструкции** (аналог .cursor/rules через ~/.continue)
- **RAG интеграция** через Sourcegraph Cody
- **LangChain поддержка** для создания сложных агентов
- **Агентский режим** для многофайлового редактирования

### **Обновления Copilot:**
- **Агентский режим** в предварительной версии (preview)
- **Умные действия** в терминале, системах контроля версий, отладке
- **MCP поддержка** через расширения в VSCode

### **Механизмы .cursor/rules (детально):**
- **Always** (alwaysApply: true) — применяются ко всем взаимодействиям
- **Auto Attached** (globs) — активируются по шаблонам файлов  
- **Agent Requested** (description) — ИИ запрашивает правило по описанию
- **Manual** (@ruleName) — указывается явно пользователем

### **Продвинутые API возможности:**
- **Function Calling** — все API (OpenAI, Anthropic, xAI Grok, Ollama)
- **Мультимодальность** — GPT-4o, Claude, LLaVA (обработка текста и изображений)
- **Длинные контексты** — до 1M токенов (OpenAI, xAI Grok)
- **Потоковые ответы** — реальное время для всех API
- **RAG интеграция** — через LangChain, RAGFlow
- **Управление памятью** — сохранение контекста между сессиями
- **Параллельная обработка** — множественные запросы/модели

### **Cursor 1.0 улучшения:**
- **Улучшена работа с правилами** (тестируется пользователем)
- Возможно исправлены предыдущие проблемы с игнорированием директив

**Рекомендация:**
- Для production-решений и массовых сценариев — использовать MCP (VSCode/agent mode), API/CLI/rules для остальных.
- OpenCtx и ToolSpec фиксировать как экспериментальные/нишевые протоколы, не делать на них ставку в основной архитектуре.
- Регулярно ревизировать интеграционную матрицу и обновлять этот раздел при появлении новых стандартов.

## Источники обновлений
- **Compatibility Analysis Dump** (.ARCHIVE/compatibility_discussion_dump.txt) — комплексный анализ интеграции сред разработки с AI моделями (июнь 2025)

---

_Этот файл — основа для ведения базы знаний, автоматизации, ревизии и передачи best practices в проекте. Регулярно обновляйте и ревизируйте._ 