# Мастер-план пофазового внедрения "живого" workflow engine и мультиагентности для llmgenie

Дата: 2024-06-13
Автор: ai_assistant

---

## Фаза 0. Подготовка и аудит
### Цели:
- Аудит текущей архитектуры, данных, процессов.
- Уточнение требований, сбор pain points.
- Подготовка инфраструктуры для FastAPI/MCP.

### Чеклист:
- [ ] Провести аудит текущих workflow, логирования, struct.json, roles, rules.
- [ ] Зафиксировать pain points и требования (отдельный doc).
- [ ] Подготовить dev-ветку и окружение для FastAPI/MCP.
- [ ] Составить карту данных (json, базы знаний, логи, чеклисты).

### Технологии:
- Python, FastAPI, MCP, json, git, docs.

---

## Фаза 1. MVP: Базовый workflow engine + handoff между ролями
### Цели:
- Реализовать FastAPI-слой для управления workflow, логами, данными.
- Интегрировать MCP-сервер с мультиплексированными тулзами.
- Прототип handoff: кодер → библиотекарь (логирование, передача метаданных).
- Always-on enforcement для критичных политик.

### Чеклист:
- [ ] Реализовать FastAPI backend с базовыми endpoints:
    - [ ] /actions
    - [ ] /workflow/state
    - [ ] /policy/{name}
    - [ ] /context/{key}
    - [ ] /action
    - [ ] /enforce
- [ ] Реализовать MCP-сервер (gateway к FastAPI):
    - [ ] get_available_actions
    - [ ] run_action
    - [ ] enforce_policy
- [ ] Настроить always-on правила (security, branch, logging).
- [ ] Прототип передачи handoff (кодер → библиотекарь):
    - [ ] Формат метаданных и логов
    - [ ] API для передачи состояния
    - [ ] Документация handoff
- [ ] Логирование и восстановление сессий (session_log, meta-log).
- [ ] Чеклисты и decision list для контроля качества.
- [ ] Документировать API, сценарии, роли.

#### Вторичный чеклист: Что можно сделать за один эпик с AI
- [ ] Спроектировать и реализовать FastAPI backend (минимум: /actions, /action, /workflow/state, /enforce).
- [ ] Реализовать MCP-сервер с мультиплексированными тулзами.
- [ ] Настроить always-on enforcement для security/branch/logging.
- [ ] Прототип handoff: логирование работы кодера, передача метаданных библиотекарю.
- [ ] Документировать сценарии и API.

### Технологии:
- Python, FastAPI, MCP, json, git, docs.

---

## Фаза 2. Расширение: knowledge base, memory, базы данных
### Цели:
- Внедрить базы знаний, persistent memory, автоматизацию сбора и обновления данных.
- Расширить handoff: аналитик, ревьюер, интеграция с таск-менеджерами.

### Чеклист:
- [ ] Реализовать knowledge base (json/db, API для LLM).
- [ ] Внедрить persistent memory (memories, базы данных).
- [ ] Автоматизация сбора и обновления данных (логов, связей, статусов).
- [ ] Расширить handoff: аналитик, ревьюер, таск-менеджеры.
- [ ] Документировать интерфейсы и сценарии.

### Технологии:
- FastAPI, json/db, MCP, docs, интеграция с таск-менеджерами.

---

## Фаза 3. Оркестрация, слои контекста, мультиагентность
### Цели:
- Внедрить оркестратор для управления ролями, потоками, сессиями.
- Реализовать слои контекста, message bus, автоматическую маршрутизацию handoff.
- Поддержка параллельных веток обсуждения/разработки.

### Чеклист:
- [ ] Реализовать оркестратор (FastAPI/microservices/message bus).
- [ ] Слои контекста: session, project, global.
- [ ] Автоматическая маршрутизация handoff между ролями.
- [ ] Поддержка параллельных веток и возврата к ним.
- [ ] Документировать архитектуру и сценарии.

### Технологии:
- FastAPI, message bus, microservices, MCP, docs.

---

## Фаза 4. Мультидоменность и масштабирование
### Цели:
- Расширить архитектуру на новые домены: наука, бизнес, ассистенты.
- Поддержка новых типов данных, ролей, сценариев.
- Масштабирование и интеграция с внешними системами.

### Чеклист:
- [ ] Абстрагировать доменные сценарии и роли.
- [ ] Поддержка новых типов данных и API.
- [ ] Интеграция с внешними системами (API, плагины, сервисы).
- [ ] Документировать best practices и lessons learned.

### Технологии:
- FastAPI, MCP, плагины, внешние API, docs.

---

## Итог
- Мастер-план готов к доработке и детализации.
- Для MVP-эпика (фаза 1) — можно реализовать FastAPI backend, MCP, always-on enforcement, handoff между ролями и документацию с помощью AI за одну сессию/эпик.
- Все фазы предполагают поэтапное внедрение, фиксацию lessons learned и расширение архитектуры. 